DROP PROCEDURE IF EXISTS `_idempotent_script`;

DELIMITER //

CREATE PROCEDURE `_idempotent_script`()
BEGIN
  DECLARE CurrentMigration TEXT;

  IF EXISTS(SELECT 1 FROM information_schema.tables 
  WHERE table_name = '__MigrationHistory' 
  AND table_schema = DATABASE()) THEN 
    SET CurrentMigration = (SELECT
`Project1`.`MigrationId`
FROM `__MigrationHistory` AS `Project1`
 WHERE `Project1`.`ContextKey` = 'MySqlComMigration.Migrations.Configuration'
 ORDER BY 
`Project1`.`MigrationId` DESC LIMIT 1);
  END IF;

  IF CurrentMigration IS NULL THEN
    SET CurrentMigration = '0';
  END IF;

  IF CurrentMigration < '201507211155038_MigrationV1' THEN 
create table `contato` (`id` bigint not null  auto_increment ,`nome` longtext not null ,`email` longtext,`telefone` longtext,`salario` double,`NotaAluno` decimal( 18, 2 )  not null ,`rowversion` datetime,`obs` longtext,`id_cliente` bigint,primary key ( `id`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_id_cliente` on `contato` (`id_cliente` DESC) using HASH;
create table `pessoa` (`id_pessoa` bigint not null  auto_increment ,`nome_pess` longtext not null ,`id_pes_rep` bigint,`id_pes_tra` bigint,`tipo` int not null ,primary key ( `id_pessoa`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_id_pes_rep` on `pessoa` (`id_pes_rep` DESC) using HASH;
CREATE index  `IX_id_pes_tra` on `pessoa` (`id_pes_tra` DESC) using HASH;
create table `endereco` (`id` bigint not null  auto_increment ,`nome` bigint not null ,`id_cliente` bigint,primary key ( `id`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_id_cliente` on `endereco` (`id_cliente` DESC) using HASH;
create table `standard` (`StandardId` int not null  auto_increment ,`StandardName` longtext,primary key ( `StandardId`) ) engine=InnoDb auto_increment=0;
create table `student` (`StudentID` int not null  auto_increment ,`StudentName` longtext,`DateOfBirth` datetime not null ,`Photo` longblob,`Height` decimal( 18, 2 )  not null ,`Weight` float not null ,`id_standard` int,primary key ( `StudentID`) ) engine=InnoDb auto_increment=0;
CREATE index  `IX_id_standard` on `student` (`id_standard` DESC) using HASH;
alter table `contato` add constraint `FK_contato_pessoa_id_cliente`  foreign key (`id_cliente`) references `pessoa` ( `id_pessoa`) ;
alter table `pessoa` add constraint `FK_pessoa_pessoa_id_pes_rep`  foreign key (`id_pes_rep`) references `pessoa` ( `id_pessoa`) ;
alter table `pessoa` add constraint `FK_pessoa_pessoa_id_pes_tra`  foreign key (`id_pes_tra`) references `pessoa` ( `id_pessoa`) ;
alter table `endereco` add constraint `FK_endereco_pessoa_id_cliente`  foreign key (`id_cliente`) references `pessoa` ( `id_pessoa`) ;
alter table `student` add constraint `FK_student_standard_id_standard`  foreign key (`id_standard`) references `standard` ( `StandardId`) ;
create table `__MigrationHistory` (`MigrationId` nvarchar(100)  not null ,`ContextKey` nvarchar(200)  not null ,`Model` longblob not null ,`ProductVersion` nvarchar(32)  not null ,primary key ( `MigrationId`,`ContextKey`) ) engine=InnoDb auto_increment=0;
INSERT INTO `__MigrationHistory`(
`MigrationId`, 
`ContextKey`, 
`Model`, 
`ProductVersion`) VALUES (
'201507211155038_MigrationV1', 
'MySqlComMigration.Migrations.Configuration', 
0x1F8B0800000000000400ED5CDB72E336127D4F55FE41C5C75445F24CB2A9EC949CD48C2F893791EDB29CCCA30B2221191592E092E0ACF56DFBB09FB4BF90062F20880B09D292464AE5CD02D0078D46A3D1000FFCFFFFFE6FFEE34B144E3EE13423343EF7DE4CCFBC098E7D1A907873EEE56CFDF5F7DE8F3F7CF9C5FC2A885E26BFD7EDBEE1ED4032CECEBD67C69277B359E63FE30865D388F829CDE89A4D7D1ACD5040676FCFCEFE397BF3668601C203ACC964FE90C78C44B8F8013F2F68ECE384E5285CD0008759550E35CB0275728B229C25C8C7E7DE62BBFC777841A305D9A4888136D342C69BBC0F09027596385C7B1314C79415D5EF7ECBF092A534DE2C132840E1E336C1D06E8DC20C578378D734771DCFD95B3E9E592338CA1E9E18298CF50A6CC2B65CBD62BCE71E9805B0A9DC089AFD82B7AD0228BA4F698253B67DC0EB4A9404DE64D6969BA982424C92E1BD9F7B3731FBEE5B6F729B87215A8558184BB2EA92D114FF84630C9380837BC4184EC17837012E46A1F5AEF415D308D7BDC1EC80B77993057AF915C71BF60C938C5EBCC93579C1415D5269F05B4CC0394188A5393668D8DD2B4C080977D06D772F0C87784DE35D8CAFBBA30C852825B4EEE792E6608A3EA1E016A65088609F44084C729FC25F550CF8DE9B2C7DC48DFA76B08553FA9F2A98882EC03F1E099F6DBECAF33485F0B25D14632C0CD0874857D9DE0D4982273F24E0B95859018AD82DFA443685FF2B0017B5F4030E8BFAEC9924652C9ADEE32CA3E8A95ACC3098EB94460F949B54A97A7A44E90633D0819AEB97344F7D6534F35913373AA34909362E983C25A5F0889822440F195A8A4E0F1F5FCAD13EA538E9F623B3184B552BF5C4199288B55F78DAD5239454D3DCABBADD9785A3BECE996B67B53973EDECAE7A5DC50186286551ACAE7D124BB1D14CADD3D699D6C0B4D0BA747BC0498A3310453D514069A859AF556F3361BBD1503B3EA66885C267DAA566D346D3B0AEB22927EA4D7A3907AB7A46FEEAB98FADB7CFB85F0D5A49AA135897DA282F58828707280DC678412D7B33C21B645961DF6F4CD9D0EEBCA2EE93FFDA7DC263F58425CBB982E6A05A553E8979905C41ADD382AAD6E055D94B8536CE130AD19BCB318E20440FE7074597FB7103A52F9E9BDFAD3F90943DEBE9FAC09874FF4C9948473E9018A55B378DBB617FC664F3CCF6765EF9D8825F8299C351695F265648CB4FDC57612DFEDA55A80664EB32755B8579246FCA727E79935D876893498E07913FDC8205650BB4C7BFC0D10AA715DA35CC9F0F40BFA330879F679AB55AADFF95A72490DBBFE96E7FF502CB8ED054B47FAB0FB91C9C5CF81EC6E69362025AA7A626E16D7709DBDDA427FB6DD2F3DA728B3C84D43D243E581CC63D9DEA43B1E38A28DBE0D6D7440AF0571A2A8444D89C637E090632199C3748CCF4F849629F2428EC1E982236ECDCC8CD2FFA516B2E718263EEB3DD16705440E449BA06A2236553E833D37C26B949B7F768B9946D9AED899574BCAB73E2DE89EEC035F8CF00BF1CE541361D0EE74236EB9E840F194F8E3DE1C2728CEC9BF32E4FEA3C7B1ED09BBAF438785032DAD95D8BF2A6E8737A9538E8F74CBB7EEADF812F6957058777235585837B906AD801CE53DC177E16E7D13252DB44DBD3D366A6EB93DD00FFB19F3D65D83A5BDE970BD9B4709942FBEDC42027B2D9D7D18B9A53CB01DCA83C6214691C89459ECE7FE317ED2367D9788999F22974D21C54D4EC57F39636421D5034807BE35AD6E49BEC4B4368AA7A30EA69CA0C204BCB5C1840EA1B1B0346B5941408694654834857F9522BCB6DBFEA24FDC71FA17C33019AABF51F762414DB74CFDA637418BF7ECFA91BA03B7F77CBE025E56D8EE296B2F7DA728411CC9F25AC9ED09184BAA7A1A37CC29C77EED124CD2710AB35CCC99353FA34CA065ABEB48FE1EBB74DFAF8BBF77FB70C40D2BD89681D36B0EEF92D20115F9DED50DF7D898D49D4CD6725FBA82A98CF2C34A5F90225098937126DA92A992C4BCED2C5D7CBE1F4A0A8C498F999812524B4153D319AA20D566A79BC0CF0354933768918780FBFA9BB082243B3EE6DB8EEA68398D4BAB5AFDBF3BF4B190B6F6B6AC16A8C780DE38A78CA535CAC1BB6024D72C279639C1B63F8C87741C33C8A6D1F0ABBA4CBCF76B27C59E28E50D18F6488AAC81DA32117C9304DA93B92600FC940A2D01DA72214C928BCE47D98C7837064EA900C2697BBA315B42119A628709797AF7DDA3E63BF0EE23142715A2DADD6968812A7D415E7B41E4DD49E91CBD10CE5B01A6D821D06AE4FD18A7D6D876B3B9644F951D767553C68E2C5CD8CAE98F9C6A617AD38AA1BD08C47783B5AC9F8692DFCA2E4681CD14CDB18E98A36300767B48B1EEBDE7052F1A6C9B37631CFB62CD2619EEDA2363BCB172FB29DBB2E64FAD1CAAFF526BCB2E68866AE4AB5773371064E86E3BC5924ED8616448CB6952DD40E072CD39C4915EE782D16858CD7AA70C7AB9814325255E48E51D3266490BACC1DE5A301E5E36094D645A312DBEC37907B5E22DAB14F6D227A17C73FE59837AF8E5CFD4F56B43358D984B358E82712F0F357B1C4A6BC7E5AAEB622E6372D1628266B9CB147FA078653F83FA6DF290F5E463C3E996559101EE90B9415D9103EFE5E32D540AA8ECCBD0C69BCE187DED73D2331A18C7925321647790412548F4086814807B60A66FF0F430298515630CDA43ECE866A2E3D0F196B419D4D5B7B5F17CE89BDBBD8E7826ABDB618BDAAF4C7132ED360C5915E538CC3919F5728E286F19C00B3FD10315537F54842FB4E97E0F1F0C8F7320126EAB85B303C35FAF59ECCA731AEC76E25064275FF36379C5ECDD55B85743554BD36997AE77B7C9B4CBD0E291A1509542EF5E838F05A36EFEBD9BBE26BF581E9BA07E431D9BFDF1C2197D2998FBB2B0768BEF88F22F29E860B745CD41EA10F8CE0D3EE8AC65F1ED54750274FC30FA441BA777A321CD8BF9D608F4E70125CD6765A329C65AA9159C6F160479255AD1F59F6CD4E3D2936AACA96516770302DB5BCEB856C7BC593803285F577C55935815BAE8C546C273EAB091F0F65BB76925D4D3DD81CC14685ED62C29AF13F2F4D7628FD4FF1B2E3E6C18E1BA2EA8D9D74D963E3B98EA373967940AFE47130588F6D883B67A9B643559B5CE0404B35F159F74342D5BF3AC22E28FD3B3DD88533B26920F83FD78BB1DFDAFF449B9B784DEBBD58D1A86EA2DCCF2C3043016C8EEF5346D6C86750EDC3A416FF9FA07A697D15AD707013DFE52CC9190C1947ABB0F56F0FF876DED57FC1B46DEB3CBF4B8A57F1BB1802A849F8ADDC5DFC21276120F4BE36DCEA5B20789E50DD40F2B964FC2672B31548B71A15D30654994FA4378F384A4200CBEEE225FA84EDBAF5DBB06DB1F925419B14455985D1C8C34F70BF207AF9E14F6FEDCB3310520000, 
'6.0.0-20911');
  END IF;

  IF CurrentMigration < '201507211156226_MigrationV2' THEN 
set @columnType := (select case lower(IS_NULLABLE) when 'no' then CONCAT(column_type, ' not null ')  when 'yes' then column_type end from information_schema.columns where table_name = 'pessoa' and column_name = 'nome_pess');
set @sqlstmt := (select concat('alter table `pessoa` change `nome_pess` `nome` ' , @columnType));
prepare stmt from @sqlstmt;
execute stmt;
deallocate prepare stmt;
INSERT INTO `__MigrationHistory`(
`MigrationId`, 
`ContextKey`, 
`Model`, 
`ProductVersion`) VALUES (
'201507211156226_MigrationV2', 
'MySqlComMigration.Migrations.Configuration', 
0x1F8B0800000000000400ED5CDB72E336127D4F55FE41C5C75445F24CB2A9644A4E6AC697C4D9C876594EE6D10591908C5A92E092E0ACF56D79C827ED2F6C831710C48504694923A5F6CD22D0078DEE46A3011EFABF7FFE35FFE9250A279F709A111A9F7B6FA667DE04C73E0D48BC39F772B6FEFA7BEFA71FBFFC627E15442F933FEA7EDFF07E201967E7DE3363C9BBD92CF39F7184B26944FC946674CDA63E8D6628A0B3B767673FCCDEBC996180F0006B32993FE43123112E7EC0CF0B1AFB3861390A1734C061563D879665813AB94511CE12E4E3736FB15DFE3BBCA0D1826C52C4409B6921E34DDE8704813A4B1CAEBD098A63CA8AE677BF6778C9521A6F96093C40E1E336C1D06F8DC20C579378D774779DCFD95B3E9F592338CA1E9E9829CCF50A6CC2B65CBD62BEE71E9805B0A9DC09BAFD136F5B0FE0D17D4A139CB2ED035E57A224F026B3B6DC4C151462920C1FFDDCBB89D977DF7A93DB3C0CD12AC4C2589255978CA6F8671C6370020EEE11633805E3DD04B8988536BA32564C235C8F06DE8168F3260BF4F21B8E37EC199C8C5EBCC93579C141FDA4D2E0F798407082104B736CD0B07B5470080977306CF7280C87784DE35DCCAF7BA00C852825B41EE792E6608A3EA1E0165C2844B04F220426B94FE1AF2A077CEF4D963EE2467D3BD8C229FD4F954CC410101F8F847B9BAFF23C4D21BD6C17C51C0B03F421D255B6774392E0C90F09442E56568022768B3E914D11FF0AC0452DFD80C3A23D7B2649998BA6F738CB287AAA16334CE63AA5D103E526559A9E1E51BAC10C74A0E6F625CD535F99CD7CD6E48DCE6C52828D4B264F49293C22A708D1BF776A2927FA94E2A43B84CC622C550DD493624822967D1164578FF0A4F270AFEAF6301631FABA38AEE3D416C7759CBBEA75150718129445B1BAF549ACC24633B54D5B625A07D31AEBD2ED012729CE4014F52400A5A366BD56BBCD84ED4E43EDF898A2150A9F69979A4D1F4DC3BAC9A69C6837E9E59CA76A8FFCDDCB1EDB689F71AB1AB492D420B02EB55151B084080F501A8C89825AF6664434C8B2C2BEDF980AA1DD45453D26FFB5FB5AC71A094B967305CD49B56A7C127E9042416DD392AAD6E155854B85362E120AD19BCB318120440F1707C590FB0903652C5E96DFAD3F90943DEB95FAC09C74FF4C9928473E9018A55B378DBB617FC164F3CCF67654F9D8825F8299C351655F2656482B4EDC57612DFEDA55A82664EB32755B8579246FCA727D79935D876893498107993FDC8205650BB4E7BFC0D10AA715DA35F8CF07A03F5098C3CF33CD5AADDEBFE62909E4FE6FBAFB5FBDC0B2233415FDDFEA532E27273F7C0F73F349E180D681A92978DB43C27637E9A97E9BF2BCB6DC220FA1740F890F1687794FA7FA54ECB822CB36B8F50D9102FC95860A291136E798DF7F814C06E70D12333D7F92D827090ABB27A6880D3B3272F38B71D4964B9CE098C76CB7051C15107592AE811848D914FACC349F4961D21D3D5A2D6573B3BDB0928E77754DDCEBE80E5C43FC0C88CB511164D3E1702164B3EE49C490F1E4D8932E2CC7C83E9F774552E7D9F380D1D4A5C7C19392D1CEEE5A9437459F33AAC441BFC7EDFAA97F07B1A45D151C3E8C54150E1E41AA6107044F715FF8598247AB486D8EB697A78DA7EB93DD80F8B19F3D65D8BA5ADE5708D9B47071A1FD76625010D9ECEB1845CDA9E50061541E318A328EC4A24EE7BFF18BF67EB3ECBCC44C790B3A690E2A6AF5AB454B1BA14E281AC0BD712D6BF24DF5A521344D3D18B59B3203C8D2E20B03487D6363C0A8969202217944358874952FF5B2DCF6AB41D27FFC11CA370ED042ADFFB023A1D8DC3D6BCFD161FEFA3DA76E80EEFADDAD829794B7058A5BC9DE6BCB114630BF96B046424711EA5E868E8A0973DDB9479334AF40ACD630174F4EE5D3281B68F5D23EA6AFDF36E9F3EFDEFFDD2A0049F726A375D8C0BAE7B780447E75B6437DF7253626D1369F95C4A3EAC17C666128CD17284948BC91184BD593C9B2A42B5D7CBD1CCE0C8A4A8C999F190842425B3112A329DA60A595E7CB005F933463978841F4F09BBA8B203274EBDE86EB613A3849AD5BFBBA3FFFBB94B150B6A616ACC688D730AF88973CC5C5BA612BD024279C32C6693186977C1734CCA3D8F6A2B04BBA7C6D27CB974FDC112AE6910C513D72C7687845324CF3D41D4910876420F1D01DA7E212C928FCC9FB308F07E1C8AC21194C7EEE8E5630866498E281BBBC7CEDD38E19FB7510CF114AD06A65B5B644943CA5AE38A7F56862F58C5C8E662887D56813EC30707D8A56EC6B3B5CDBB15EBF34E5FB185D1DF33D4D2F5A714037A0190FEE76B492E7D35AEEC593A3093F3359636400DAC01C42D02E7AAC3BC2496599A6BADA859F6DB5A3839FEDA2363BCBD72DB29DBBAE61FAD1CA77F426BCB2E5883C5715D8BB719C8189E1E8378BA4DDD0827ED1B6B285D0E18065F299D4E08ED7E24EC878AD0677BC8A3F2123558FDC316AB2840C523F7347F96840F93818A575BDA8E436FBBDE39E978876D853BB88D1C5A14F39DCCDAB8356FF372ADAC9ABECC2B92BF41309F8A9AB586253DE3E2D575B91F39B1E0B149335CED823FD1786B3F73FA6DF295FB88CF8DA6496654178A49F9CACC886F0F9F752A806127464C66548E30D3FEABEEEBB1113CA98CF42C6E2285F7D04D5571FC340A4635A05B3FF2F4102F0282BF865D21867433597BE07196B419D435B475F17CE897D6871D40B4AFF5AC2C503561CE9F3897138F2F7148AB8613E2740653F84F775538F64B0EF74F51D0F717C2F0E3071C5DDF2E0A9F1ADF7643E8D623D76173130A8FB77B8E17C6AAEDE2AA4ABA1EAB5D9D33BDFDEDBECE97548D1A84CA092A747E781D7D2775F4FD715AFA70FCCCF3D2071C9FEC2E608C993CE04DC5D0540F38A7F1473F73442A0E38EF608636004817657BCFDF2943E822B791A71204DD27DD09321BDFE3F08F6180427415E6D9725C369A51A7B651CF175243BD5FA7E65DF74D493A29FAAF418D5838379A8E5352F54DB2B5E049425ACBF2B92AA09DC725BA4623B11584DF87828BDB593DD6A1AC1160836EE6B17F5D58CFF7979B143F97E4A941D37F175DC14D568ECE4C71E1BB1751C7FB3AC037A258F83B27A6C53DC392DB59DAADABC02071EAA89C0BA1FD6A9FEC2117641E95FE7C12E9C914D03C1FF915E8CFDD6FE27FADCC46B5AEFC58A467517E57E6681190A60737C9F32B2463E83661F9C5AFC4382EAD3EAAB6885839BF82E6749CE60CA385A85ADFF73C0B7F3AEF10B6A6D5BE7F95D527C06BF8B29809A84DFCADDC51F72120642EF6BC3ADBE0582D709D50D24F725E337919BAD40BAD5B89736A0CA7CA2BC79C45112025876172FD1276CD7ADDF866D8BCD2F09DAA428CA2A8C461E7E42F805D1CB8FFF034DDF4C82FC510000, 
'6.0.0-20911');
  END IF;

END //

DELIMITER ;

CALL `_idempotent_script`();

DROP PROCEDURE IF EXISTS `_idempotent_script`;

